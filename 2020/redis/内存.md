### 内存使用统计  
可以通过执行`info memory`命令获取内存相关指标  
需要重点关注的指标由：used_memory_rss、used_memory以及它们的比值mem_fragmentation_ratio  
当mem_fragmentation_ratio>1时，说明used_memory_rss-used_memory多出的部分并没有用于数据存储，而是被内存碎片所消耗，如果两者相差很大，说明碎片率很严重  
当mem_fragmentation_ratio<1时，这种情况一般出现在现在操作系统把redis内存交换(swap)到硬盘导致，出现这种情况时要格外关注，redis性能会变得很差，甚至僵死  
#### 内存消耗划分  
redis进程内存消耗主要包括：自身内存+对象内存+缓冲内存+内存碎片，其中redis空进程自身内存消耗非常少，通常used_memoey_rss在3MB左右，used_memory在800KB左右，一个空的redis进程消耗内存可以忽略不计  
![title](https://raw.githubusercontent.com/liujinxi931204/image/master/gitnote/2020/09/25/1601027457818-1601027457867.png)  
+ 对象内存  
对象内存时redis内存占用最大的一块，存储着用户所有的数据。对象内存的消耗可以理解为sizeof(key)+sizeof(values)。键对象都是字符串，在使用redis时很容易忽略键对内存消耗的影响，应当避免使用过长的键  
+ 缓冲内存  
缓冲内存主要包括：客户端缓冲区、复制积压缓冲区、AOF缓冲区  
客户端缓冲指的是所有接入redis服务器TCP连接的输入输出缓冲。输入缓冲区无法控制，最大为1G，超过将断开连接；输出缓冲通过参数client-outputbuffer-limit控制  
一般普通客户端的内存消耗可以忽略不计，但是当有大量慢连接客户端接入时这部分内存消耗就不能忽略了，可以设置max-client做限制  
主节点会为每一个从节点单独建立一条连接用于命令复制，当主从节点之间网络延迟较高或者主节点挂载大量从节点时这部分内存消耗将占用很大一部分，建议主节点挂载的从节点不要多余2个  
