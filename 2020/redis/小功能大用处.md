## 慢查询分析  
所谓慢查询日志就是系统在命令执行前后计算每条命令的执行时间，当超过设定的阈值，就将这条命令的相关信息(例如发生时间、耗时、命令的详细信息)记录下来  
redis客户端执行一条命令分为如下4个部分：  
![title](https://raw.githubusercontent.com/liujinxi931204/image/master/gitnote/2020/09/15/1600155147221-1600155147222.png)  
需要注意：慢查询只统计命令执行的时间，所以没有慢查询并不代表客户端没有超时  
+ 慢查询阈值怎么设置  
redis提供了slowlog-log-slower-than配置来解决这个问题，它的单位时微秒，默认值是10000。如果设置slowlog-log-slower-than=0，会记录所有命令；如果设置slowlog-log-slower-than<0,对于任何命令都会不记录  
+ 慢查询记录存放在哪里  
实际上redis使用了一个列表来存储慢查询日志，slowlog-max-len就是这个列表的最大长度。一个新命令满足慢查询条件时被插入到这个列表中，当慢查询日志列表已处于最大长度时，最早插入的一个命令将会从列表中移除  
如果要redis将配置持久化到本地配置文件，需要执行config rewrite命令，如下将慢查询配置本地化  
```shell
config set slowlog-log-slower-than 20000
config set slowlog-max-len 1000
config rewrite
```  
![title](https://raw.githubusercontent.com/liujinxi931204/image/master/gitnote/2020/09/15/1600155883609-1600155883611.png)  
虽然慢查询日志是存放在redis内存列表中的，但是redis并没有暴露这个列表的键，而是通过一组命令来实现对慢查询日志的访问和管理  
1. 获取慢查询日志  
`slowlog get [n]`  
每个慢查询日志有四个属性组成，分别是慢查询日志的标识id、发生时间戳、命令耗时、执行命令和参数  
![title](https://raw.githubusercontent.com/liujinxi931204/image/master/gitnote/2020/09/15/1600156942347-1600156942348.png)  
2. 获取慢查询日志列表的当前长度  
`slowlog len`  
3. 慢查询日志重置  
`slowlog reset`  
## redis-cli  
1. -x 选项代表从标准输入(stdin)读取数据作为redis-cli的最后一个参数  
`echo "world" | redis-cli -x set hello`  
上面操作会将字符串world作为hello的值  
2. --slave 选项是把当前客户端模拟成当前redis节点的从节点，可以用来获取当前redis节点的更新操作  
3. --edb 选项会请求redis实例生成并发送rdb持久化文件，保存在本地，可以使用它做持久化文件的定期备份  
4. --bigkeys 选项使用scan命令对redis的键进行采样，从中找到内存中占用比较大的键值，这些键可能是系统的瓶颈  
5. --latency  有三个选项
+ --latency  该选项可以测试客户端到目标redis的网络延迟  
+ --latency-history 以分时段的形式了解延迟信息，可以通过-i参数控制间隔时间  
+ --latency-list  该选项会使用统计图表的形式从控制台输出延迟统计信息  
6. --stat 该选项可以实时获取redis的重要统计信息  
## Pipeline  
### pipeline概念  
redis客户端执行一条命令分为如下四个过程  
+ 发送命令  
+ 命令排队  
+ 命令执行  
+ 返回结果  
其中发送命令的时间+返回结果的时间称为RRT往返时间，Pipeline机制能将一组redis命令进行组装，通过一次RTTR传输给redis，再将这组redis命令的执行结果按照顺序返回给客户端  
`redis-cli --pipe`其实就是使用




