假设有一张表T，里面只有一个字段ID,当执行下面这条SQL语句时：  
`select * from T where ID=10；`  
我们可以肉眼看到输入只是一条SQL语句，返回的是查询结果，却不知道这条SQL语句在MySQL内部经历了哪些。如下是MySQL的基本架构示意图，从图中可以看到SQL语句在MySQL中各个功能模块的执行过程  
![title](https://gitee.com/liujinxi931204/image/raw/master/gitnote/2020/07/27/1595839894222-1595839894224.png)  
大体来说，MySQL可以分为Server层和存储引擎两部分。Server层：包括连接器、分析器、查询缓存、优化器、执行器等。存储引擎：负责数据的存储和提取。其架构模式是插件式的，支持InnoDB、MyISAM、Memory等多种存储模式。从MySQL5.5版本以后，默认的存储引擎就是InnoDB，也就是说在创建表时如果不使用语句engine=MyISAM指定的话，存储引擎就是InnoDB的  
## 连接器  
首先需要通过连接器和MySQL取得连接，因此连接器的主要工作就是跟客户端建立联系、获取权限、维持和管理连接。连接命令如下:  
`mysql -h$ip -P$port -u$user -p`  
如果用户名或者密码不对，则会收到一个“Access deined for user”错误，然后客户端程序结束执行  
如果用户名密码认证通过，连接器则会去权限表中查询该用户所拥有的权限，这个连接里面的权限逻辑判断全部都依赖此时读到的权限。这也就意味着，在用户建立连接成功后，即使是管理员修改了改用户的权限，也不会立即生效，只有重新建立连接后才会使用新的设置  
## 查询缓存  
在连接建立以后，执行SQL语句首先就来查询缓存  
MySQL拿到一个查询语句以后会先到缓存查看是否在此之前执行过这条语句。之前执行过的语句及其结果可能会以key-value的形式被至直接缓存在内存中。key是查询的语句，values是查询的结果。  
如果能够在缓存中找到这个key，结果直接被返回给客户端，然后结束  
如果语句在缓存中查询不到，就会继续执行后面的阶段。执行结束后，执行结果会被存入查询缓存中。  
**但是大多数情况下不建议使用缓存，因为查询缓存的弊往往大于利**  
查询缓存的失效非常频繁，只要对表一更新，这个表上所有的查询缓存就会被清空。好在MySQL也提供了按需使用的方式，可以通过设置参数"query_cache_type"设置成DEMAND，这样对于默认的MySQL语句都不使用查询缓存。如果确定要使用查询缓存，可以显示的指定  
`select SQL_CACHE * from T where ID=10:`  
**值得注意的是，在MySQL8.0以后，彻底取消了查询缓存的功能 **  
## 分析器  
如果没有命中查询缓存，就要开始正真的执行语句了。  
首先MySQL需要知道你要做什么，因此需要对SQL语句进行解析  
分析器也会分为几步：
1.词法分析，一条SQL语句有多个字符串组成，首先要提取关键字，比如select，提出查询的表、提出字段名、提出查询条件等  
2.语法分析，主要判断输入的SQL语句是否正确，是否符合SQL语法  
如果语法不对，就会收到"You have an error in your SQL syntax"的错误提醒  
## 优化器  
经过了分析其，MySQL就知道你要做什么了。在开始执行之前，还要先经过优化器的处理  
优化器在表里面有多个索引的时候，决定使用哪个索引；或者在一个语句有多个关联查询（join）的时候，决定各个表的连接顺序。优化器选择方案是它认为最优的，虽然有时候也不一定是最优的。  
## 执行器  
MySQL通过分析器知道你要做什么，通过优化器知道了该怎么做，于是就进入执行器阶段，开始执行SQL语句  
在开始执行之前，会先判断当前用户对这个表T有没有执行权限。如果没有，就会返回没有权限的错误；如果有权限，就会打开表继续执行。打开表的时候，执行器根据表的引擎定义，去使用这个引擎提供的接口  
在执行之前，判断有没有执行的权限  
命中查询缓存，在返回结果之前做权限验证  
查询会在优化器之前调用precheck验证权限  





